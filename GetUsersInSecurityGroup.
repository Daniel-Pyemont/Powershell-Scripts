#Change the Security Group Name to match the enviroment.
$groupName = "GroupName"
#Change the output path and file name to match the enviroment.
$outputFile = "C:\Temp\GetUsersinSecurityGroup\outputFile.csv"

# Import the Active Directory module
Import-Module ActiveDirectory

# Retrieve the security group members
$groupMembers = Get-ADGroupMember -Identity $groupName | Where-Object {$_.objectClass -eq 'user'}

# Create an array to store the results
$results = @()

# Iterate through the group members and add them to the results array
foreach ($member in $groupMembers) {
    $user = Get-ADUser -Identity $member.SamAccountName -Properties DisplayName, SamAccountName
    $result = [PSCustomObject]@{
        DisplayName    = $user.DisplayName
        StafflinkID = $user.SamAccountName
    }
    $results += $result
}

# Export the results to a CSV file in current directory.
$results | Export-Csv -Path $outputFile -NoTypeInformation
